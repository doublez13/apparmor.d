# apparmor.d - Full set of apparmor profiles
# Copyright (C) 2023-2024 Alexandre Pujol <alexandre@pujol.io>
# SPDX-License-Identifier: GPL-2.0-only

# Allow to display Status Notifier Items in the KDE Plasma systray

  abi <abi/4.0>,

  #aa-dbus common bus=session name=org.kde.StatusNotifierWatcher label=gnome-shell

  dbus send bus=session path=/StatusNotifierWatcher
       interface=org.freedesktop.DBus.Introspectable
       member=Introspect
       peer=(name=org.kde.StatusNotifierWatcher, label="@{pp_app_indicator}"),

  dbus send bus=session path=/StatusNotifierWatcher
       interface=org.freedesktop.DBus.Properties
       member=Get
       peer=(name=org.kde.StatusNotifierWatcher, label="@{pp_app_indicator}"),

  dbus receive bus=session path=/StatusNotifierItem
       interface=org.freedesktop.DBus.Properties
       member=GetAll
       peer=(label="@{pp_app_indicator}"),


  dbus send bus=session path=/{StatusNotifierItem/menu,org/ayatana/NotificationItem/*/Menu}
       interface=com.canonical.dbusmenu
       member={LayoutUpdated,ItemsPropertiesUpdated}
       peer=(name=org.freedesktop.DBus, label="@{pp_app_indicator}"),

  dbus receive bus=session path=/{StatusNotifierItem,StatusNotifierItem/menu,org/ayatana/NotificationItem/**}
       interface={org.freedesktop.DBus.Properties,com.canonical.dbusmenu}
       member={Get*,AboutTo*,Event*}
       peer=(label="@{pp_app_indicator}"),

  dbus send bus=session path=/StatusNotifierWatcher
       interface=org.kde.StatusNotifierWatcher
       member=RegisterStatusNotifierItem
       peer=(label="@{pp_app_indicator}"),

  dbus receive bus=session path=/StatusNotifierItem
       interface=org.kde.StatusNotifierItem
       member={ProvideXdgActivationToken,Activate}
       peer=(label="@{pp_app_indicator}"),

  dbus receive bus=session  path=/MenuBar
       interface=com.canonical.dbusmenu
       member={AboutToShow,GetLayout,Event}
       peer=(label="@{pp_app_indicator}"),

  include if exists <abstractions/bus/org.kde.StatusNotifierWatcher.d>

# vim:syntax=apparmor
